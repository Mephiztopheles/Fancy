(function(){function s(e,t){return e+"."+t}function o(u,a){var f=e(u);var l=this;l.id=n;l.name=r;l.version="2.0.1";l.element=f;l.defaultValue=l.value=l.element.val();l.settings=e.extend({multiple:l.element.attr("multiple")||l.element.hasClass("multiple"),search:l.element.attr("search")||l.element.hasClass("search"),selectedText:false,create:l.element.attr("create")||l.element.hasClass("create")},a);if(!i){t.version(l);i=true;e(document).on(s("click",l.name),function(t){var n=!e(t.target).closest("."+l.name).length;n=n||e(t.target).hasClass("."+l.name+"-option");if(e(t.target).closest("."+l.name).hasClass(l.name+"-multiple"))n=n&&!e(t.target).hasCLass("."+l.name+"-option");n=n||e(t.target).hasClass(l.name+"-option-reset");if(n){e("."+l.name).each(function(){o.api.close(this)})}})}l.createClient();l.buildOptions();l.buildFilter();l.applySettings();l.addEventListener();l.select(l.element.val());if(typeof t.scroll=="function"){l.scroller=new t.scroll(l.client.options)}l.element.data(l.name,l);l.client.data(l.name,l);n++;return l}if(typeof Fancy=="undefined"){console.error("Fancy is required");return}var e=jQuery,t=Fancy,n=1,r="FancySelect",i=false;o.api=o.prototype={};o.api.open=function(e){var n=t(e).get(r)||this;if(n.length){for(var i in n){n[i].client.addClass(n[i].name+"-open");if(n[i].scroller){n[i].scroller.resize()}}}else{n.client.addClass(n.name+"-open");if(n.scroller){n.scroller.resize()}}return n};o.api.close=function(e){var n=t(e).get(r)||this;if(n.length){for(var i in n){n[i].client.removeClass(n[i].name+"-open")}}else{n.client.removeClass(n.name+"-open")}return n};o.api.createClient=function(){var t=this;t.client=e("<div/>",{id:t.name+"-box-"+t.id,"class":t.name});t.client.selected=e("<div/>",{id:t.name+"-selected-"+t.id,"class":t.name+"-selected"});t.client.options=e("<div/>",{id:t.name+"-options-"+t.id,"class":t.name+"-options"});t.element.after(t.client);t.client.prepend(t.element);t.element.addClass(t.name+"-element");t.client.prepend(t.client.selected).append(t.client.options)};o.api.buildOptions=function(){var t=this;t.options=[];t.search=[];var n=1,r=false,i;t.client.options.html("");t.element.children().each(function(s){var o=e(this);s++;var u=e("<div/>",{id:t.name+"-"+t.id+"-option-"+s});var a=e("<span/>",{id:t.name+"-"+t.id+"-option-text-"+s,"class":t.name+"-option-text",html:o.text()});u.append(a);if(o.data("description")){var f=e("<span/>",{id:t.name+"-"+t.id+"-option-description-"+s,"class":t.name+"-option-description",html:o.data("description")});u.append(f)}e.each(o.data(),function(e,t){u.data(e,t)});var l=o.prop("value");if(!l){l="";u.addClass(t.name+"-option-reset")}u.data("value",l).attr("unselectable","on").css("user-select","none").on("selectstart",false);u.addClass(t.name+"-option");if(o.parent()[0].nodeName!="OPTGROUP"){t.search.push([u.text().toLowerCase(),u.data("search")?u.data("search").toLowerCase():"",u]);t.client.options.append(u);t.options.push(u);r=false}else{if(!o.parent().is(r)){i=e("<div/>",{id:t.name+"-"+t.id+"-optgroup-"+n});i.addClass(t.name+"-optgroup");var c=e("<div/>",{id:t.name+"-"+t.id+"-opttitle-"+n,html:o.parent().attr("label")});c.addClass(t.name+"-opttitle");i.append(c);t.client.options.append(i);r=o.parent()}i.append(u);n++}});if(!t.settings.fallback){if(t.options[0].hasClass(t.name+"-option-reset")){t.settings.fallback=t.options[0].data("text")||t.options[0].html()}else{t.settings.fallback=t.element.attr("placeholder")}}return t};o.api.buildFilter=function(){var r=this;if(r.settings.search&&!r.settings.create){r.input=e("<input/>",{type:"text","class":r.name+"-input"});r.input.clear=e("<div/>",{style:"position: absolute; display: none;","class":r.name+"-input-clear",html:"x"});r.client.options.prepend(r.input);r.input.after(r.input.clear);r.input.on("input",function(){if(r.input.val().length>0){for(var e in r.search){var n=r.search[e];r.input.clear.show();var i,s;if(r.settings.search=="strict"){i=n[0].indexOf(r.input.val().toLowerCase())==0;s=n[1].indexOf(r.input.val().toLowerCase())==0}else{i=n[0].indexOf(r.input.val().toLowerCase())>=0;s=n[1].indexOf(r.input.val().toLowerCase())>=0}if(i||s){n[2].show()}else{n[2].hide()}}}else{r.input.clear.hide();for(var e in r.search){r.search[e][2].show()}}if(typeof t.scroll=="function"){r.scroller.enable().resize()}});r.input.clear.on("click",function(){r.input.val("");r.input.trigger("input")})}else if(r.settings.create){r.input=e("<input/>",{type:"text","class":r.name+"-input"});r.client.options.prepend(r.input);r.input.on("input",function(){if(r.input.val().length>0){r.element.attr("value",input.val()).trigger("change")}else{e("#"+r.name+"-"+n+"-option-1").trigger("click")}})}return this};o.api.applySettings=function(){if(this.settings.multiple){this.client.addClass(this.name+"-multiple")}};o.api.addEventListener=function(){function n(){if(!t.client.hasClass(t.name+"-open")){e("."+t.name).each(function(){o.api.close(e(this))});t.open()}else{t.close()}}var t=this;t.client.on(s("click",t.name),function(r){var i=e(r.target),s=i.hasClass(t.name+"-selected")||i.parent().hasClass(t.name+"-selected"),o=i.hasClass(t.name+"-option")||i.parent().hasClass(t.name+"-option");if(s){n()}else if(o){i=i.hasClass(t.name+"-option")?i:i.parent();if(!t.settings.multiple){var u=i.data("value"),a=u!=t.value;t.select(u);if(a)t.element.trigger("change");t.close()}else{var u=[],f=i.hasClass(t.name+"-option-reset")||i.parent().hasClass(t.name+"-option-reset"),l=t.client.options.children().first().hasClass("selected")&&t.client.options.children().first().hasClass(t.name+"-option-reset"),c="",h="";if(i.hasClass("selected")){if(!f){i.removeClass("selected");var p=[],d=t.client.options.children(".selected");d.each(function(){p.push(e(this).data("value"))});t.element.val(p);t.element.trigger("change")}else{t.close()}}else{i.addClass("selected");if(!f&&l||l){t.client.options.children().first().removeClass("selected")}else if(f){t.client.options.children(".selected").removeClass("selected");t.client.options.children().first().addClass("selected");t.close()}var p=[],d=t.client.options.children(".selected");d.each(function(){p.push(e(this).data("value"))});var a=p!=t.value;t.element.val(p);if(a)t.element.trigger("change")}}}});t.client.on(s("selectstart",t.name),function(e){e.preventDefault()});t.element.on(s("change",t.name),function(){t.select(t.element.val())}).on(t.name+":change",function(){t.select(t.element.val())})};o.api.select=function(n,i){var s=t(i).get(r)||this,o="",u="";if(s.settings.multiple){if(typeof n=="string")n=n.split(",");s.client.options.children(".selected").removeClass("selected");if(n){e.each(n,function(e,t){for(var n in s.options){var r=s.options[n];if(r.data("value")==t){r.addClass("selected");o+=(e>0?", ":"")+(r.data("text")||r.html());u+=(e>0?", ":"")+(r.data("text")||r.children()[0].innerHTML)}}})}else{var a=s.options[0];if(a.hasClass(s.name+"-option-reset")){a.addClass("selected");o=a.data("text")||a.html();u=a.data("text")||a.children()[0].innerHTML}}}else if(s.settings.create){for(var f in s.options){var l=s.options[f];if(n==s.client.options.children().first().data("value")||n==null||n==""){if(l.data("value")==l.data("text")){l.addClass("selected");o=l.data("text")||l.html();u=l.data("text")||l.children()[0].innerHTML}else{l.removeClass("selected")}}else{if(l.data("value")==text){l.addClass("selected");o=l.data("text")||l.html();u=l.data("text")||l.children()[0].innerHTML}else{l.removeClass("selected")}}}}else{for(var f in s.options){var l=s.options[f];if(l.data("value")==n){l.addClass("selected");o=l.data("text")||l.html();u=l.data("text")||l.children()[0].innerHTML}else{l.removeClass("selected")}}}if(!u){u=s.settings.fallback;o=s.settings.fallback}if(s.client.options.children("."+s.name+"-option-reset").data("text")!=u)e(s.settings.selectedtext).html(u);s.client.selected.html(o).attr("title",u);s.element.val(n);s.value=n};t.api.select=function(e){var t=this.get(r);if(t&&t.length){for(var n in t){if(typeof t[n]=="undefined"){t[n]=new o(this.element[n],e)}}}if(!t)return new o(this.element,e);else return t}})()
(function(){function i(e,t){return e+"."+t}function s(o,u){var a=e(o);if(a.length>1){var f=[];a.each(function(){f.push(new s(this,u))});return f}var l=this;l.id=n;l.name="FancySelect";l.version="2.0.0";l.element=a;l.defaultValue=l.value=l.element.val();l.settings=e.extend({multiple:l.element.attr("multiple")||l.element.hasClass("multiple"),searchable:l.element.attr("searchable")||l.element.hasClass("searchable"),selectedText:false,create:l.element.attr("create")||l.element.hasClass("create")},u);if(!r){t.fn.version(l);r=true;e(document).on(i("click",l.name),function(t){var n=!e(t.target).closest("."+l.name).length;n=n||e(t.target).hasClass("."+l.name+"-option");if(e(t.target).closest("."+l.name).hasClass(l.name+"-multiple"))n=n&&!e(t.target).hasCLass("."+l.name+"-option");n=n||e(t.target).hasClass(l.name+"-option-reset");if(n){e("."+l.name).each(function(){s.api.close(this)})}})}l.createClient();l.buildOptions();l.buildFilter();l.applySettings();l.addEventListener();l.select(l.element.val());if(typeof t.scroll=="function"){l.scroller=new t.scroll(l.client.options)}l.element.data(l.name,l);l.client.data(l.name,l);n++;return l}if(typeof jQuery!="function"){console.error("jQuery required")}if(typeof Fancy=="undefined"){console.error("Fancy is required");return}var e=jQuery,t=Fancy,n=1,r=false;s.api=s.prototype={};s.api.open=function(e){var t=Fancy.get.select(e)||this;if(t.length){for(var n in t){t[n].client.addClass(t[n].name+"-open");if(t[n].scroller){t[n].scroller.resize()}}}else{t.client.addClass(t.name+"-open");if(t.scroller){t.scroller.resize()}}return t};s.api.close=function(e){var t=Fancy.get.select(e)||this;if(t.length){for(var n in t){t[n].client.removeClass(t[n].name+"-open")}}else{t.client.removeClass(t.name+"-open")}return t};s.api.createClient=function(){var t=this;t.client=e("<div/>",{id:t.name+"-box-"+t.id,"class":t.name});t.client.selected=e("<div/>",{id:t.name+"-selected-"+t.id,"class":t.name+"-selected"});t.client.options=e("<div/>",{id:t.name+"-options-"+t.id,"class":t.name+"-options"});t.element.after(t.client);t.client.prepend(t.element);t.element.addClass(t.name+"-element");t.client.prepend(t.client.selected).append(t.client.options)};s.api.buildOptions=function(){var t=this;t.options=[];t.search=[];var n=1,r=false,i;t.client.options.html("");t.element.children().each(function(s){var o=e(this);s++;var u=e("<div/>",{id:t.name+"-"+t.id+"-option-"+s});var a=e("<span/>",{id:t.name+"-"+t.id+"-option-text-"+s,"class":t.name+"-option-text",html:o.text()});u.append(a);if(o.data("description")){var f=e("<span/>",{id:t.name+"-"+t.id+"-option-description-"+s,"class":t.name+"-option-description",html:o.data("description")});u.append(f)}e.each(o.data(),function(e,t){u.data(e,t)});var l=o.prop("value");if(!l){l="";u.addClass(t.name+"-option-reset")}u.data("value",l).attr("unselectable","on").css("user-select","none").on("selectstart",false);u.addClass(t.name+"-option");if(o.parent()[0].nodeName!="OPTGROUP"){t.search.push([u.text().toLowerCase(),u.data("search")?u.data("search").toLowerCase():"",u]);t.client.options.append(u);t.options.push(u);r=false}else{if(!o.parent().is(r)){i=e("<div/>",{id:t.name+"-"+t.id+"-optgroup-"+n});i.addClass(t.name+"-optgroup");var c=e("<div/>",{id:t.name+"-"+t.id+"-opttitle-"+n,html:o.parent().attr("label")});c.addClass(t.name+"-opttitle");i.append(c);t.client.options.append(i);r=o.parent()}i.append(u);n++}});if(!t.settings.fallback){if(t.options[0].hasClass(t.name+"-option-reset")){t.settings.fallback=t.options[0].data("text")||t.options[0].html()}else{t.settings.fallback=t.element.attr("placeholder")}}return t};s.api.buildFilter=function(){var r=this;if(r.searchable&&!r.createable){r.input=e("<input/>",{type:"text","class":r.name+"-input"});r.input.clear=e("<div/>",{style:"position: absolute; display: none;","class":r.name+"-input-clear",html:"x"});r.client.options.prepend(r.input);r.input.after(r.input.clear);r.input.on("input",function(){if(r.input.val().length>0){for(var e in r.search){var n=r.search[e];r.input.clear.show();var i,s;if(r.settings.searchable=="strict"){i=n[0].indexOf(r.input.val().toLowerCase())==0;s=n[1].indexOf(r.input.val().toLowerCase())==0}else{i=n[0].indexOf(r.input.val().toLowerCase())>=0;s=n[1].indexOf(r.input.val().toLowerCase())>=0}if(i||s){n[2].show()}else{n[2].hide()}}}else{r.input.clear.hide();for(var e in r.search){r.search[e][2].show()}}if(typeof t.scroll=="function"){r.scroller.enable().resize()}});r.input.clear.on("click",function(){r.input.val("");r.input.trigger("input")})}else if(r.settings.createable){r.input=e("<input/>",{type:"text","class":r.name+"-input"});r.client.options.prepend(r.input);r.input.on("input",function(){if(r.input.val().length>0){r.element.attr("value",input.val()).trigger("change")}else{e("#"+r.name+"-"+n+"-option-1").trigger("click")}})}return this};s.api.applySettings=function(){if(this.settings.multiple){this.client.addClass(this.name+"-multiple")}};s.api.addEventListener=function(){function n(){if(!t.client.hasClass(t.name+"-open")){e("."+t.name).each(function(){s.api.close(e(this))});t.open()}else{t.close()}}var t=this;t.client.on(i("click",t.name),function(r){var i=e(r.target),s=i.hasClass(t.name+"-selected")||i.parent().hasClass(t.name+"-selected"),o=i.hasClass(t.name+"-option")||i.parent().hasClass(t.name+"-option");if(s){n()}else if(o){i=i.hasClass(t.name+"-option")?i:i.parent();if(!t.settings.multiple){var u=i.data("value"),a=u!=t.value;t.select(u);if(a)t.element.trigger("change");t.close()}else{var u=[],f=i.hasClass(t.name+"-option-reset")||i.parent().hasClass(t.name+"-option-reset"),l=t.client.options.children().first().hasClass("selected")&&t.client.options.children().first().hasClass(t.name+"-option-reset"),c="",h="";if(i.hasClass("selected")){if(!f){i.removeClass("selected");var p=[],d=t.client.options.children(".selected");d.each(function(){p.push(e(this).data("value"))});t.element.val(p);t.element.trigger("change")}else{t.close()}}else{i.addClass("selected");if(!f&&l||l){t.client.options.children().first().removeClass("selected")}else if(f){t.client.options.children(".selected").removeClass("selected");t.client.options.children().first().addClass("selected");t.close()}var p=[],d=t.client.options.children(".selected");d.each(function(){p.push(e(this).data("value"))});var a=p!=t.value;t.element.val(p);if(a)t.element.trigger("change")}}}});t.client.on(i("selectstart",t.name),function(e){e.preventDefault()});t.element.on(i("change",t.name),function(){t.select(t.element.val())}).on(t.name+":change",function(){t.select(t.element.val())})};s.api.select=function(t,n){var r=Fancy.get.select(n)||this,i="",s="";if(r.settings.multiple){if(typeof t=="string")t=t.split(",");r.client.options.children(".selected").removeClass("selected");if(t){e.each(t,function(e,t){for(var n in r.options){var o=r.options[n];if(o.data("value")==t){o.addClass("selected");i+=(e>0?", ":"")+(o.data("text")||o.html());s+=(e>0?", ":"")+(o.data("text")||o.children()[0].innerHTML)}}})}else{var o=r.options[0];if(o.hasClass(r.name+"-option-reset")){o.addClass("selected");i=o.data("text")||o.html();s=o.data("text")||o.children()[0].innerHTML}}}else if(r.settings.create){for(var u in r.options){var a=r.options[u];if(t==r.client.options.children().first().data("value")||t==null||t==""){if(a.data("value")==a.data("text")){a.addClass("selected");i=a.data("text")||a.html();s=a.data("text")||a.children()[0].innerHTML}else{a.removeClass("selected")}}else{if(a.data("value")==text){a.addClass("selected");i=a.data("text")||a.html();s=a.data("text")||a.children()[0].innerHTML}else{a.removeClass("selected")}}}}else{for(var u in r.options){var a=r.options[u];if(a.data("value")==t){a.addClass("selected");i=a.data("text")||a.html();s=a.data("text")||a.children()[0].innerHTML}else{a.removeClass("selected")}}}if(!s){s=r.settings.fallback;i=r.settings.fallback}if(r.client.options.children("."+r.name+"-option-reset").data("text")!=s)e(r.settings.selectedtext).html(s);r.client.selected.html(i).attr("title",s);r.element.val(t);r.value=t};Fancy.get.select=function(t){var n=e(t);if(n.length>1){var r=[];n.each(function(){r.push(e(this).data("FancySelect"))});return r}else if(n.length){return n.data("FancySelect")}};t.select=s})()